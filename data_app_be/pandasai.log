2025-03-28 11:34:31 [INFO] Question: Who gets paid the most?
2025-03-28 11:34:31 [INFO] Running PandaAI with bamboo_llm LLM...
2025-03-28 11:34:31 [INFO] Prompt ID: 4c896035-01b7-4bc7-901b-2b8e93e95765
2025-03-28 11:34:31 [INFO] Generating new code...
2025-03-28 11:34:31 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_f429f651884f4941543d85bc5583ea4e" dimensions="5x3">
EmployeeID,Name,Department
1,John,HR
2,Emma,Sales
3,Liam,IT
4,Olivia,Marketing
5,William,Finance
</table>


<table dialect="duckdb" table_name="table_8a25a04fdd74977afdf9a87b59394611" dimensions="5x2">
EmployeeID,Salary
1,5000
2,6000
3,4500
4,7000
5,5500
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 Who gets paid the most?

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-28 11:34:46 [INFO] Code Generated:
# Import the required dependencies
import pandas as pd

# Write the SQL query to join the two tables and sort by salary
sql_query = """
SELECT t1.Name, t2.Salary
FROM table_f429f651884f4941543d85bc5583ea4e as t1
JOIN table_8a25a04fdd74977afdf9a87b59394611 as t2
ON t1.EmployeeID = t2.EmployeeID
ORDER BY t2.Salary DESC
"""

# Execute the SQL query and get the result
df = execute_sql_query(sql_query)

# Get the employee with the highest salary
highest_paid_employee = df.iloc[0]

# Declare the result
result = { "type": "dataframe", "value": highest_paid_employee }
2025-03-28 11:34:46 [INFO] Validating code requirements...
2025-03-28 11:34:46 [INFO] Code validation successful.
2025-03-28 11:34:46 [INFO] Cleaning the generated code...
2025-03-28 11:34:46 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT t1.Name, t2.Salary
FROM table_f429f651884f4941543d85bc5583ea4e as t1
JOIN table_8a25a04fdd74977afdf9a87b59394611 as t2
ON t1.EmployeeID = t2.EmployeeID
ORDER BY t2.Salary DESC
"""
df = execute_sql_query(sql_query)
highest_paid_employee = df.iloc[0]
result = {'type': 'dataframe', 'value': highest_paid_employee}
2025-03-28 11:34:47 [INFO] Response generated successfully.
2025-03-28 11:35:20 [INFO] Question: Who gets paid the most?
2025-03-28 11:35:20 [INFO] Running PandaAI with bamboo_llm LLM...
2025-03-28 11:35:20 [INFO] Prompt ID: 8e4e1abd-bfba-4c2b-8cc7-0458bf2ccd0c
2025-03-28 11:35:20 [INFO] Generating new code...
2025-03-28 11:35:20 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_f429f651884f4941543d85bc5583ea4e" dimensions="5x3">
EmployeeID,Name,Department
1,John,HR
2,Emma,Sales
3,Liam,IT
4,Olivia,Marketing
5,William,Finance
</table>


<table dialect="duckdb" table_name="table_8a25a04fdd74977afdf9a87b59394611" dimensions="5x2">
EmployeeID,Salary
1,5000
2,6000
3,4500
4,7000
5,5500
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 Who gets paid the most?

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-28 11:35:33 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

def execute_sql_query(sql_query: str) -> pd.DataFrame:
    """This method connects to the database, executes the sql query and returns the dataframe"""
    # Connect to the database and execute query here
    pass

# Write SQL query to get the employee with the highest salary
sql_query = """
    SELECT Name, MAX(Salary) as Salary
    FROM table_f429f651884f4941543d85bc5583ea4e 
    JOIN table_8a25a04fdd74977afdf9a87b59394611 
    ON table_f429f651884f4941543d85bc5583ea4e.EmployeeID = table_8a25a04fdd74977afdf9a87b59394611.EmployeeID
"""

# Execute SQL query and get the result
df = execute_sql_query(sql_query)

# Extract the Name and Salary of the employee who gets paid the most
highest_paid_employee = df.iloc[0]['Name']
highest_salary = df.iloc[0]['Salary']

# Declare result var
result = { "type": "string", "value": f"The highest salary is {highest_salary} and it is received by {highest_paid_employee}." }
2025-03-28 11:35:33 [INFO] Validating code requirements...
2025-03-28 11:35:33 [INFO] Code validation successful.
2025-03-28 11:35:33 [INFO] Cleaning the generated code...
2025-03-28 11:35:33 [INFO] Executing code: import pandas as pd
sql_query = """
    SELECT Name, MAX(Salary) as Salary
    FROM table_f429f651884f4941543d85bc5583ea4e 
    JOIN table_8a25a04fdd74977afdf9a87b59394611 
    ON table_f429f651884f4941543d85bc5583ea4e.EmployeeID = table_8a25a04fdd74977afdf9a87b59394611.EmployeeID
"""
df = execute_sql_query(sql_query)
highest_paid_employee = df.iloc[0]['Name']
highest_salary = df.iloc[0]['Salary']
result = {'type': 'string', 'value': f'The highest salary is {highest_salary} and it is received by {highest_paid_employee}.'}
2025-03-28 11:35:34 [INFO] Retrying execution (1/3)...
2025-03-28 11:35:34 [INFO] Execution failed with error: Traceback (most recent call last):
  File "C:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_execution\code_executor.py", line 29, in execute
    exec(code, self._environment)
  File "<string>", line 8, in <module>
  File "C:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 150, in _execute_sql_query
    return db_manager.sql(final_query).df()
  File "C:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\data_loader\duck_db_connection_manager.py", line 39, in sql
    return self.connection.sql(query, params=params)
duckdb.duckdb.BinderException: Binder Error: column "Name" must appear in the GROUP BY clause or must be part of an aggregate function.
Either add it to the GROUP BY list, or use "ANY_VALUE(Name)" if the exact value of "Name" is not important.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 186, in execute_with_retries
    result = self.execute_code(code)
  File "C:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 118, in execute_code
    return code_executor.execute_and_return_result(code)
  File "C:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_execution\code_executor.py", line 38, in execute_and_return_result
    self.execute(code)
  File "C:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_execution\code_executor.py", line 31, in execute
    raise CodeExecutionError("Code execution failed") from e
pandasai.exceptions.CodeExecutionError: Code execution failed

2025-03-28 11:35:34 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_f429f651884f4941543d85bc5583ea4e" dimensions="5x3">
EmployeeID,Name,Department
1,John,HR
2,Emma,Sales
3,Liam,IT
4,Olivia,Marketing
5,William,Finance
</table>
<table dialect="duckdb" table_name="table_8a25a04fdd74977afdf9a87b59394611" dimensions="5x2">
EmployeeID,Salary
1,5000
2,6000
3,4500
4,7000
5,5500
</table>


The user asked the following question:
### QUERY
 Who gets paid the most?

You generated the following Python code:
import pandas as pd
sql_query = """
    SELECT Name, MAX(Salary) as Salary
    FROM table_f429f651884f4941543d85bc5583ea4e 
    JOIN table_8a25a04fdd74977afdf9a87b59394611 
    ON table_f429f651884f4941543d85bc5583ea4e.EmployeeID = table_8a25a04fdd74977afdf9a87b59394611.EmployeeID
"""
df = execute_sql_query(sql_query)
highest_paid_employee = df.iloc[0]['Name']
highest_salary = df.iloc[0]['Salary']
result = {'type': 'string', 'value': f'The highest salary is {highest_salary} and it is received by {highest_paid_employee}.'}

However, it resulted in the following error:
Traceback (most recent call last):
  File "C:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_execution\code_executor.py", line 29, in execute
    exec(code, self._environment)
  File "<string>", line 8, in <module>
  File "C:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 150, in _execute_sql_query
    return db_manager.sql(final_query).df()
  File "C:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\data_loader\duck_db_connection_manager.py", line 39, in sql
    return self.connection.sql(query, params=params)
duckdb.duckdb.BinderException: Binder Error: column "Name" must appear in the GROUP BY clause or must be part of an aggregate function.
Either add it to the GROUP BY list, or use "ANY_VALUE(Name)" if the exact value of "Name" is not important.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 186, in execute_with_retries
    result = self.execute_code(code)
  File "C:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 118, in execute_code
    return code_executor.execute_and_return_result(code)
  File "C:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_execution\code_executor.py", line 38, in execute_and_return_result
    self.execute(code)
  File "C:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_execution\code_executor.py", line 31, in execute
    raise CodeExecutionError("Code execution failed") from e
pandasai.exceptions.CodeExecutionError: Code execution failed


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-28 11:35:53 [INFO] Code Generated:
import pandas as pd
sql_query = """
    SELECT Name, Salary
    FROM table_f429f651884f4941543d85bc5583ea4e 
    JOIN table_8a25a04fdd74977afdf9a87b59394611 
    ON table_f429f651884f4941543d85bc5583ea4e.EmployeeID = table_8a25a04fdd74977afdf9a87b59394611.EmployeeID
    ORDER BY Salary DESC
    LIMIT 1
"""
df = execute_sql_query(sql_query)
highest_paid_employee = df.iloc[0]['Name']
highest_salary = df.iloc[0]['Salary']
result = {'type': 'string', 'value': f'The highest salary is {highest_salary} and it is received by {highest_paid_employee}.'}
2025-03-28 11:35:53 [INFO] Validating code requirements...
2025-03-28 11:35:53 [INFO] Code validation successful.
2025-03-28 11:35:53 [INFO] Cleaning the generated code...
2025-03-28 11:35:53 [INFO] Executing code: import pandas as pd
sql_query = """
    SELECT Name, Salary
    FROM table_f429f651884f4941543d85bc5583ea4e 
    JOIN table_8a25a04fdd74977afdf9a87b59394611 
    ON table_f429f651884f4941543d85bc5583ea4e.EmployeeID = table_8a25a04fdd74977afdf9a87b59394611.EmployeeID
    ORDER BY Salary DESC
    LIMIT 1
"""
df = execute_sql_query(sql_query)
highest_paid_employee = df.iloc[0]['Name']
highest_salary = df.iloc[0]['Salary']
result = {'type': 'string', 'value': f'The highest salary is {highest_salary} and it is received by {highest_paid_employee}.'}
2025-03-28 11:35:53 [INFO] Response generated successfully.
2025-03-28 11:40:24 [INFO] Question: Which are the top 5 countries by sales?
2025-03-28 11:40:24 [INFO] Running PandaAI with bamboo_llm LLM...
2025-03-28 11:40:24 [INFO] Prompt ID: 845f06e6-98ae-4093-a727-072eb0f11c75
2025-03-28 11:40:24 [INFO] Generating new code...
2025-03-28 11:40:24 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_3196ce98cf3ce3223735e1d61022e9d2" dimensions="10x2">
country,revenue
United States,5000
United Kingdom,3200
France,2900
Germany,4100
Italy,2300
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 Which are the top 5 countries by sales?

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-28 11:40:34 [INFO] Code Generated:
# Required dependencies
import pandas as pd

# Function to execute SQL query
def execute_sql_query(sql_query: str) -> pd.Dataframe:
    """This method connects to the database, executes the sql query and returns the dataframe"""

# SQL query to fetch the top 5 countries by sales
sql_query = """
    SELECT country, revenue
    FROM table_3196ce98cf3ce3223735e1d61022e9d2
    ORDER BY revenue DESC
    LIMIT 5
"""

# Execute the SQL query and get the result as a DataFrame
result_df = execute_sql_query(sql_query)

# Declare result var
result = { "type": "dataframe", "value": result_df }
2025-03-28 11:40:34 [INFO] Validating code requirements...
2025-03-28 11:40:34 [INFO] Code validation successful.
2025-03-28 11:40:34 [INFO] Cleaning the generated code...
2025-03-28 11:40:34 [INFO] Executing code: import pandas as pd
sql_query = """
    SELECT country, revenue
    FROM table_3196ce98cf3ce3223735e1d61022e9d2
    ORDER BY revenue DESC
    LIMIT 5
"""
result_df = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': result_df}
2025-03-28 11:40:34 [INFO] Response generated successfully.
2025-03-28 11:41:35 [INFO] Question: Which are the top 5 countries by sales?
2025-03-28 11:41:35 [INFO] Running PandaAI with bamboo_llm LLM...
2025-03-28 11:41:35 [INFO] Prompt ID: c2e599b6-cdbd-40d6-9607-8a787dbb667a
2025-03-28 11:41:35 [INFO] Generating new code...
2025-03-28 11:41:35 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_3196ce98cf3ce3223735e1d61022e9d2" dimensions="10x2">
country,revenue
United States,5000
United Kingdom,3200
France,2900
Germany,4100
Italy,2300
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 Which are the top 5 countries by sales?

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-28 11:41:46 [INFO] Code Generated:
# Import the required dependencies
import pandas as pd

# Function to execute SQL Query
def execute_sql_query(sql_query: str) -> pd.Dataframe:
    """This method connects to the database, executes the sql query and returns the dataframe"""
    # TODO: Add logic to connect to the database and execute the SQL query

# SQL query to get the top 5 countries by sales
sql_query = "SELECT country, revenue FROM table_3196ce98cf3ce3223735e1d61022e9d2 ORDER BY revenue DESC LIMIT 5"

# Execute the SQL query and store the result in a dataframe
df = execute_sql_query(sql_query)

# Declare result variable
result = { "type": "dataframe", "value": df }
2025-03-28 11:41:46 [INFO] Validating code requirements...
2025-03-28 11:41:46 [INFO] Code validation successful.
2025-03-28 11:41:46 [INFO] Cleaning the generated code...
2025-03-28 11:41:46 [INFO] Executing code: import pandas as pd
sql_query = 'SELECT country, revenue FROM table_3196ce98cf3ce3223735e1d61022e9d2 ORDER BY revenue DESC LIMIT 5'
df = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': df}
2025-03-28 11:41:47 [INFO] Response generated successfully.
2025-03-28 11:45:28 [INFO] Question: Which are the top 5 countries by sales?
2025-03-28 11:53:50 [INFO] Question: Which are the top 5 countries by sales?
2025-03-28 11:54:57 [INFO] Question: Which are the top 5 countries by sales?
2025-03-28 11:56:09 [INFO] Question: Which are the top 5 countries by sales?
2025-03-28 11:57:21 [INFO] Question: Which are the top 5 countries by sales?
2025-03-28 11:58:46 [INFO] Question: Which are the top 5 countries by sales?
2025-03-28 11:59:02 [INFO] Question: Which are the top 5 countries by sales?
2025-03-28 11:59:02 [INFO] Running PandaAI with bamboo_llm LLM...
2025-03-28 11:59:02 [INFO] Prompt ID: b553bb51-16d2-48ea-a280-149d52e86359
2025-03-28 11:59:02 [INFO] Generating new code...
2025-03-28 11:59:02 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_3196ce98cf3ce3223735e1d61022e9d2" dimensions="10x2">
country,revenue
United States,5000
United Kingdom,3200
France,2900
Germany,4100
Italy,2300
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 Which are the top 5 countries by sales?

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-28 11:59:11 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# Write code here
def execute_sql_query(sql_query: str) -> pd.DataFrame:
    """This method connects to the database, executes the sql query and returns the dataframe"""

# SQL query to get top 5 countries by sales
sql_query = "SELECT country, revenue FROM table_3196ce98cf3ce3223735e1d61022e9d2 ORDER BY revenue DESC LIMIT 5"

# Execute the query
top_countries = execute_sql_query(sql_query)

# Declare result var: 
result = { "type": "dataframe", "value": top_countries }
2025-03-28 11:59:11 [INFO] Validating code requirements...
2025-03-28 11:59:11 [INFO] Code validation successful.
2025-03-28 11:59:11 [INFO] Cleaning the generated code...
2025-03-28 11:59:11 [INFO] Executing code: import pandas as pd
sql_query = 'SELECT country, revenue FROM table_3196ce98cf3ce3223735e1d61022e9d2 ORDER BY revenue DESC LIMIT 5'
top_countries = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': top_countries}
2025-03-28 11:59:12 [INFO] Response generated successfully.
2025-03-28 18:38:17 [INFO] Question: Which are the top 5 countries by sales?
2025-03-28 18:38:17 [INFO] Running PandaAI with bamboo_llm LLM...
2025-03-28 18:38:17 [INFO] Prompt ID: fe11c663-f974-4bf2-949c-5ffa947c2db2
2025-03-28 18:38:17 [INFO] Generating new code...
2025-03-28 18:38:17 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_3196ce98cf3ce3223735e1d61022e9d2" dimensions="10x2">
country,revenue
United States,5000
United Kingdom,3200
France,2900
Germany,4100
Italy,2300
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 Which are the top 5 countries by sales?

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-28 18:38:27 [INFO] Code Generated:
# Import required dependencies
import pandas as pd

# Function to execute SQL query
def execute_sql_query(sql_query: str) -> pd.Dataframe:
    """This method connects to the database, executes the sql query and returns the dataframe"""
    # Code to connect to database and execute query goes here
    pass

# SQL query to get top 5 countries by sales
sql_query = """
SELECT country, revenue
FROM table_3196ce98cf3ce3223735e1d61022e9d2
ORDER BY revenue DESC
LIMIT 5
"""

# Execute SQL query and store the result
sales_df = execute_sql_query(sql_query)

# Declare result var
result = {
    "type": "dataframe",
    "value": sales_df
}
2025-03-28 18:38:27 [INFO] Validating code requirements...
2025-03-28 18:38:27 [INFO] Code validation successful.
2025-03-28 18:38:27 [INFO] Cleaning the generated code...
2025-03-28 18:38:27 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT country, revenue
FROM table_3196ce98cf3ce3223735e1d61022e9d2
ORDER BY revenue DESC
LIMIT 5
"""
sales_df = execute_sql_query(sql_query)
result = {'type': 'dataframe', 'value': sales_df}
2025-03-28 18:38:28 [INFO] Response generated successfully.
2025-03-30 18:45:00 [INFO] Question: "What is the average age of passengers?"
2025-03-30 18:45:00 [INFO] Running PandaAI with openai LLM...
2025-03-30 18:45:00 [INFO] Prompt ID: 85699074-1b7a-47ea-ae97-38c6e6f85572
2025-03-30 18:45:00 [INFO] Generating new code...
2025-03-30 18:45:00 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 "What is the average age of passengers?"

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-30 18:45:01 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:01 [INFO] Retrying request to /chat/completions in 0.494954 seconds
2025-03-30 18:45:02 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:02 [INFO] Retrying request to /chat/completions in 0.861828 seconds
2025-03-30 18:45:03 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:03 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 18:45:03 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:03 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:03 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:45:03 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:03 [INFO] Retrying request to /chat/completions in 0.479569 seconds
2025-03-30 18:45:04 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:04 [INFO] Retrying request to /chat/completions in 0.852132 seconds
2025-03-30 18:45:05 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:05 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 18:45:05 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:05 [INFO] Retrying Code Generation (1/3)...
2025-03-30 18:45:05 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:05 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:45:05 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:05 [INFO] Retrying request to /chat/completions in 0.498223 seconds
2025-03-30 18:45:06 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:06 [INFO] Retrying request to /chat/completions in 0.849874 seconds
2025-03-30 18:45:07 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:07 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 18:45:07 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:07 [INFO] Retrying Code Generation (2/3)...
2025-03-30 18:45:07 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:07 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:45:07 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:07 [INFO] Retrying request to /chat/completions in 0.387055 seconds
2025-03-30 18:45:07 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:07 [INFO] Retrying request to /chat/completions in 0.786630 seconds
2025-03-30 18:45:08 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:08 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 18:45:08 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:08 [INFO] Retrying Code Generation (3/3)...
2025-03-30 18:45:08 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:08 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:45:08 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:08 [INFO] Retrying request to /chat/completions in 0.476356 seconds
2025-03-30 18:45:09 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:09 [INFO] Retrying request to /chat/completions in 0.852348 seconds
2025-03-30 18:45:10 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:10 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 18:45:10 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:10 [INFO] Maximum retry attempts exceeded. Last error: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 18:45:46 [INFO] Question: "What is the average age of passengers?"
2025-03-30 18:45:46 [INFO] Running PandaAI with openai LLM...
2025-03-30 18:45:46 [INFO] Prompt ID: a38fe046-2008-43df-827b-c5eba5c7a02b
2025-03-30 18:45:46 [INFO] Generating new code...
2025-03-30 18:45:46 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 "What is the average age of passengers?"

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-30 18:45:47 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:47 [INFO] Retrying request to /chat/completions in 0.443950 seconds
2025-03-30 18:45:47 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:47 [INFO] Retrying request to /chat/completions in 0.916498 seconds
2025-03-30 18:45:48 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:48 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 18:45:48 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:48 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:48 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:45:48 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:48 [INFO] Retrying request to /chat/completions in 0.499612 seconds
2025-03-30 18:45:49 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:49 [INFO] Retrying request to /chat/completions in 0.778424 seconds
2025-03-30 18:45:50 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:50 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 18:45:50 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:50 [INFO] Retrying Code Generation (1/3)...
2025-03-30 18:45:50 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:50 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:45:50 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:50 [INFO] Retrying request to /chat/completions in 0.498129 seconds
2025-03-30 18:45:51 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:51 [INFO] Retrying request to /chat/completions in 0.764241 seconds
2025-03-30 18:45:52 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:52 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 18:45:52 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:52 [INFO] Retrying Code Generation (2/3)...
2025-03-30 18:45:52 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:52 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:45:52 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:52 [INFO] Retrying request to /chat/completions in 0.448752 seconds
2025-03-30 18:45:52 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:52 [INFO] Retrying request to /chat/completions in 0.924029 seconds
2025-03-30 18:45:53 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:53 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 18:45:53 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:53 [INFO] Retrying Code Generation (3/3)...
2025-03-30 18:45:54 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:54 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:45:54 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:54 [INFO] Retrying request to /chat/completions in 0.413160 seconds
2025-03-30 18:45:54 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:54 [INFO] Retrying request to /chat/completions in 0.864520 seconds
2025-03-30 18:45:55 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:45:55 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 18:45:55 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 18:45:55 [INFO] Maximum retry attempts exceeded. Last error: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 18:47:14 [INFO] Question: "What is the average age of passengers?"
2025-03-30 18:47:14 [INFO] Running PandaAI with openai LLM...
2025-03-30 18:47:14 [INFO] Prompt ID: 046e43f2-bcac-4a27-9aa9-aeab9365e986
2025-03-30 18:47:14 [INFO] Generating new code...
2025-03-30 18:47:14 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 "What is the average age of passengers?"

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-30 18:47:15 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:47:15 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:47:15 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:47:15 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:47:15 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:47:15 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:47:15 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:47:15 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:47:15 [INFO] Retrying Code Generation (1/3)...
2025-03-30 18:47:15 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:47:15 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:47:15 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:47:15 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:47:15 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:47:15 [INFO] Retrying Code Generation (2/3)...
2025-03-30 18:47:15 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:47:15 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:47:15 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:47:15 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:47:15 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:47:15 [INFO] Retrying Code Generation (3/3)...
2025-03-30 18:47:15 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:47:15 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:47:15 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:47:15 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:47:15 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:47:15 [INFO] Maximum retry attempts exceeded. Last error: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:48:01 [INFO] Question: "What is the average age of passengers?"
2025-03-30 18:48:01 [INFO] Running PandaAI with openai LLM...
2025-03-30 18:48:01 [INFO] Prompt ID: 022deab6-0139-4c3b-b0a1-fb58f91d0b4b
2025-03-30 18:48:01 [INFO] Generating new code...
2025-03-30 18:48:01 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 "What is the average age of passengers?"

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-30 18:48:01 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:48:01 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:48:01 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:48:01 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:48:01 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:48:01 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:48:01 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:48:01 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:48:01 [INFO] Retrying Code Generation (1/3)...
2025-03-30 18:48:01 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:48:01 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:48:01 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:48:01 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:48:01 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:48:01 [INFO] Retrying Code Generation (2/3)...
2025-03-30 18:48:01 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:48:01 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:48:02 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:48:02 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:48:02 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:48:02 [INFO] Retrying Code Generation (3/3)...
2025-03-30 18:48:02 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:48:02 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:48:02 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:48:02 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:48:02 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:48:02 [INFO] Maximum retry attempts exceeded. Last error: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:49:44 [INFO] Question: "What is the average age of passengers?"
2025-03-30 18:49:44 [INFO] Running PandaAI with openai LLM...
2025-03-30 18:49:44 [INFO] Prompt ID: ba6d0dd4-7584-4fb2-8995-1eae6d466dc0
2025-03-30 18:49:44 [INFO] Generating new code...
2025-03-30 18:49:44 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 "What is the average age of passengers?"

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-30 18:49:45 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:49:45 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:49:45 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:49:45 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:49:45 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:49:45 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:49:45 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:49:45 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:49:45 [INFO] Retrying Code Generation (1/3)...
2025-03-30 18:49:45 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:49:45 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:49:45 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:49:45 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:49:45 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:49:45 [INFO] Retrying Code Generation (2/3)...
2025-03-30 18:49:45 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:49:45 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:49:45 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:49:45 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:49:45 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:49:45 [INFO] Retrying Code Generation (3/3)...
2025-03-30 18:49:45 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:49:45 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:49:45 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:49:45 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:49:45 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:49:45 [INFO] Maximum retry attempts exceeded. Last error: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:51:53 [INFO] Question: "What is the average age of passengers?"
2025-03-30 18:51:53 [INFO] Running PandaAI with openai LLM...
2025-03-30 18:51:53 [INFO] Prompt ID: 589c6faf-b3e2-4636-8830-ce5d0bd2ad85
2025-03-30 18:51:53 [INFO] Generating new code...
2025-03-30 18:51:53 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 "What is the average age of passengers?"

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-30 18:51:53 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:51:53 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:51:53 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:51:53 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:51:53 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:51:53 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:51:53 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:51:53 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:51:53 [INFO] Retrying Code Generation (1/3)...
2025-03-30 18:51:53 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:51:53 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:51:54 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:51:54 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:51:54 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:51:54 [INFO] Retrying Code Generation (2/3)...
2025-03-30 18:51:54 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:51:54 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:51:54 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:51:54 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:51:54 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:51:54 [INFO] Retrying Code Generation (3/3)...
2025-03-30 18:51:54 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:51:54 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:51:54 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:51:54 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:51:54 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:51:54 [INFO] Maximum retry attempts exceeded. Last error: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:52:35 [INFO] Question: "What is the average age of passengers?"
2025-03-30 18:52:35 [INFO] Running PandaAI with openai LLM...
2025-03-30 18:52:35 [INFO] Prompt ID: fee49aee-2ce6-4111-91ec-a477b7fcf926
2025-03-30 18:52:35 [INFO] Generating new code...
2025-03-30 18:52:35 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 "What is the average age of passengers?"

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-30 18:52:35 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:52:35 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:52:35 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:52:35 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:52:35 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:52:35 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:52:35 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:52:35 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:52:35 [INFO] Retrying Code Generation (1/3)...
2025-03-30 18:52:35 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:52:36 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:52:36 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:52:36 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:52:36 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:52:36 [INFO] Retrying Code Generation (2/3)...
2025-03-30 18:52:36 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:52:36 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:52:36 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:52:36 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:52:36 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:52:36 [INFO] Retrying Code Generation (3/3)...
2025-03-30 18:52:36 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:52:36 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:52:36 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:52:36 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:52:36 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:52:36 [INFO] Maximum retry attempts exceeded. Last error: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:54:34 [INFO] Question: "What is the average age of passengers?"
2025-03-30 18:54:34 [INFO] Running PandaAI with openai LLM...
2025-03-30 18:54:34 [INFO] Prompt ID: 49ba6a20-c6c8-4327-af2d-9c7c6744f6b4
2025-03-30 18:54:34 [INFO] Generating new code...
2025-03-30 18:54:34 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 "What is the average age of passengers?"

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-30 18:54:35 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:54:35 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:54:35 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:35 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:35 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:54:35 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:54:35 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:54:35 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:35 [INFO] Retrying Code Generation (1/3)...
2025-03-30 18:54:35 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:35 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:54:35 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:54:35 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:54:35 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:35 [INFO] Retrying Code Generation (2/3)...
2025-03-30 18:54:35 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:35 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:54:35 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:54:35 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:54:35 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:35 [INFO] Retrying Code Generation (3/3)...
2025-03-30 18:54:35 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:35 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:54:35 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:54:35 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:54:35 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:35 [INFO] Maximum retry attempts exceeded. Last error: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:54:43 [INFO] Question: "What is the average age of passengers?"
2025-03-30 18:54:43 [INFO] Running PandaAI with openai LLM...
2025-03-30 18:54:43 [INFO] Prompt ID: 6a100fa7-9011-42f3-87d4-dabfe1fb212b
2025-03-30 18:54:43 [INFO] Generating new code...
2025-03-30 18:54:43 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 "What is the average age of passengers?"

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-30 18:54:43 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:54:43 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:54:43 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:43 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:43 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:54:43 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:54:43 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:54:43 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:43 [INFO] Retrying Code Generation (1/3)...
2025-03-30 18:54:43 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:43 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:54:43 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:54:43 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:54:43 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:43 [INFO] Retrying Code Generation (2/3)...
2025-03-30 18:54:43 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:43 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:54:43 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:54:43 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:54:43 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:43 [INFO] Retrying Code Generation (3/3)...
2025-03-30 18:54:43 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:43 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:54:43 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:54:43 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:54:43 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:54:43 [INFO] Maximum retry attempts exceeded. Last error: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:57:51 [INFO] Question: "What is the average age of passengers?"
2025-03-30 18:57:51 [INFO] Running PandaAI with openai LLM...
2025-03-30 18:57:51 [INFO] Prompt ID: 45842a53-cd50-4eff-9ae0-92d921b9416e
2025-03-30 18:57:51 [INFO] Generating new code...
2025-03-30 18:57:51 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 "What is the average age of passengers?"

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-30 18:57:51 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:57:51 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:57:51 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:57:51 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:57:51 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:57:51 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:57:51 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:57:51 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:57:51 [INFO] Retrying Code Generation (1/3)...
2025-03-30 18:57:51 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:57:51 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:57:51 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:57:51 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:57:51 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:57:51 [INFO] Retrying Code Generation (2/3)...
2025-03-30 18:57:51 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:57:51 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:57:52 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:57:52 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:57:52 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:57:52 [INFO] Retrying Code Generation (3/3)...
2025-03-30 18:57:52 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:57:52 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 18:57:52 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2025-03-30 18:57:52 [INFO] An error occurred during code generation: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:57:52 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}

2025-03-30 18:57:52 [INFO] Maximum retry attempts exceeded. Last error: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-***************************************************************xuEJ. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-03-30 18:59:58 [INFO] Question: "What is the average age of passengers?"
2025-03-30 18:59:58 [INFO] Running PandaAI with openai LLM...
2025-03-30 18:59:58 [INFO] Prompt ID: 1585f40d-bb23-4bd5-841e-29ae586a33f3
2025-03-30 18:59:58 [INFO] Generating new code...
2025-03-30 18:59:58 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 "What is the average age of passengers?"

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-30 18:59:59 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:59:59 [INFO] Retrying request to /chat/completions in 0.438519 seconds
2025-03-30 18:59:59 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 18:59:59 [INFO] Retrying request to /chat/completions in 0.937949 seconds
2025-03-30 19:00:00 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:00:00 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:00:00 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:00:00 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:00:00 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 19:00:01 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:00:01 [INFO] Retrying request to /chat/completions in 0.427949 seconds
2025-03-30 19:00:01 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:00:01 [INFO] Retrying request to /chat/completions in 0.892049 seconds
2025-03-30 19:00:02 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:00:02 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:00:02 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:00:02 [INFO] Retrying Code Generation (1/3)...
2025-03-30 19:00:02 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:00:02 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 19:00:02 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:00:02 [INFO] Retrying request to /chat/completions in 0.496377 seconds
2025-03-30 19:00:03 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:00:03 [INFO] Retrying request to /chat/completions in 0.975871 seconds
2025-03-30 19:00:04 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:00:04 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:00:04 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:00:04 [INFO] Retrying Code Generation (2/3)...
2025-03-30 19:00:04 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:00:04 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 19:00:04 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:00:04 [INFO] Retrying request to /chat/completions in 0.494887 seconds
2025-03-30 19:00:05 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:00:05 [INFO] Retrying request to /chat/completions in 0.937038 seconds
2025-03-30 19:00:06 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:00:06 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:00:06 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:00:06 [INFO] Retrying Code Generation (3/3)...
2025-03-30 19:00:06 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:00:06 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 19:00:06 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:00:06 [INFO] Retrying request to /chat/completions in 0.487027 seconds
2025-03-30 19:00:06 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:00:06 [INFO] Retrying request to /chat/completions in 0.958199 seconds
2025-03-30 19:00:07 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:00:07 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:00:07 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:00:07 [INFO] Maximum retry attempts exceeded. Last error: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:02:06 [INFO] Question: "What is the average age of passengers?"
2025-03-30 19:02:06 [INFO] Running PandaAI with openai LLM...
2025-03-30 19:02:06 [INFO] Prompt ID: 538a5932-df8b-42aa-b73d-1440df4226d8
2025-03-30 19:02:06 [INFO] Generating new code...
2025-03-30 19:02:06 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 "What is the average age of passengers?"

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-30 19:02:06 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:02:06 [INFO] Retrying request to /chat/completions in 0.430812 seconds
2025-03-30 19:02:06 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:02:06 [INFO] Retrying request to /chat/completions in 0.801220 seconds
2025-03-30 19:02:07 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:02:07 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:02:07 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:02:07 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:02:07 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 19:02:07 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:02:07 [INFO] Retrying request to /chat/completions in 0.389392 seconds
2025-03-30 19:02:08 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:02:08 [INFO] Retrying request to /chat/completions in 0.886542 seconds
2025-03-30 19:02:09 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:02:09 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:02:09 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:02:09 [INFO] Retrying Code Generation (1/3)...
2025-03-30 19:02:09 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:02:09 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 19:02:09 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:02:09 [INFO] Retrying request to /chat/completions in 0.486108 seconds
2025-03-30 19:02:09 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:02:09 [INFO] Retrying request to /chat/completions in 0.987525 seconds
2025-03-30 19:02:11 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:02:11 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:02:11 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:02:11 [INFO] Retrying Code Generation (2/3)...
2025-03-30 19:02:11 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:02:11 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 19:02:11 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:02:11 [INFO] Retrying request to /chat/completions in 0.462359 seconds
2025-03-30 19:02:11 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:02:11 [INFO] Retrying request to /chat/completions in 0.963484 seconds
2025-03-30 19:02:12 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:02:12 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:02:12 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:02:12 [INFO] Retrying Code Generation (3/3)...
2025-03-30 19:02:12 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:02:12 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 19:02:12 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:02:12 [INFO] Retrying request to /chat/completions in 0.446854 seconds
2025-03-30 19:02:13 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:02:13 [INFO] Retrying request to /chat/completions in 0.852802 seconds
2025-03-30 19:02:14 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:02:14 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:02:14 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:02:14 [INFO] Maximum retry attempts exceeded. Last error: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:03:02 [INFO] Question: "What is the average age of passengers?"
2025-03-30 19:03:02 [INFO] Running PandaAI with openai LLM...
2025-03-30 19:03:02 [INFO] Prompt ID: 90b2b040-ce7b-46a0-a3c8-3fb220e8bc51
2025-03-30 19:03:02 [INFO] Generating new code...
2025-03-30 19:03:02 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 "What is the average age of passengers?"

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-30 19:03:03 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:03:03 [INFO] Retrying request to /chat/completions in 0.458942 seconds
2025-03-30 19:03:03 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:03:03 [INFO] Retrying request to /chat/completions in 0.762383 seconds
2025-03-30 19:03:04 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:03:04 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:03:04 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:03:04 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:03:04 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 19:03:04 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:03:04 [INFO] Retrying request to /chat/completions in 0.427777 seconds
2025-03-30 19:03:05 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:03:05 [INFO] Retrying request to /chat/completions in 0.921243 seconds
2025-03-30 19:03:06 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:03:06 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:03:06 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:03:06 [INFO] Retrying Code Generation (1/3)...
2025-03-30 19:03:06 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:03:06 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 19:03:06 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:03:06 [INFO] Retrying request to /chat/completions in 0.409616 seconds
2025-03-30 19:03:06 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:03:06 [INFO] Retrying request to /chat/completions in 0.955891 seconds
2025-03-30 19:03:07 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:03:07 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:03:07 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:03:07 [INFO] Retrying Code Generation (2/3)...
2025-03-30 19:03:07 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:03:07 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 19:03:07 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:03:07 [INFO] Retrying request to /chat/completions in 0.497574 seconds
2025-03-30 19:03:08 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:03:08 [INFO] Retrying request to /chat/completions in 0.858406 seconds
2025-03-30 19:03:09 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:03:09 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:03:09 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:03:09 [INFO] Retrying Code Generation (3/3)...
2025-03-30 19:03:09 [INFO] Execution failed with error: Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:03:09 [INFO] Using Prompt: <table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


The user asked the following question:
### QUERY
 "What is the average age of passengers?"

You generated the following Python code:
None

However, it resulted in the following error:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 159, in generate_code_with_retries
    return self.generate_code(query)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\agent\base.py", line 104, in generate_code
    code = self._code_generator.generate_code(prompt)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 47, in generate_code
    raise e
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}


Fix the python code above and return the new python code but the code generated should use execute_sql_query function
2025-03-30 19:03:09 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:03:09 [INFO] Retrying request to /chat/completions in 0.381055 seconds
2025-03-30 19:03:09 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:03:09 [INFO] Retrying request to /chat/completions in 0.755556 seconds
2025-03-30 19:03:10 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-03-30 19:03:10 [INFO] An error occurred during code generation: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:03:10 [INFO] Stack Trace:
Traceback (most recent call last):
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\core\code_generation\base.py", line 34, in generate_code
    code = self._context.config.llm.generate_code(prompt, self._context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai\llm\base.py", line 172, in generate_code
    response = self.call(instruction, context)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 188, in call
    self.chat_completion(self.last_prompt, memory)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\pandasai_openai\base.py", line 165, in chat_completion
    response = self.client.create(**params)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_utils\_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\resources\chat\completions\completions.py", line 914, in create
    return self._post(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1242, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 919, in request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1008, in _request
    return self._retry_request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1057, in _retry_request
    return self._request(
  File "c:\Users\Jonathan\Desktop\projects\intern project\data_app\.venv\lib\site-packages\openai\_base_client.py", line 1023, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}

2025-03-30 19:03:10 [INFO] Maximum retry attempts exceeded. Last error: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-03-30 19:03:43 [INFO] Question: "What is the average age of passengers?"
2025-03-30 19:03:43 [INFO] Running PandaAI with openai LLM...
2025-03-30 19:03:43 [INFO] Prompt ID: cee06ae9-4bfa-47fd-bdde-448e31e121d8
2025-03-30 19:03:43 [INFO] Generating new code...
2025-03-30 19:03:43 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_aec7a6bd6f78cb97d53618ce510b61d8" dimensions="891x12">
PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22.0,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38.0,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26.0,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35.0,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35.0,0,0,373450,8.05,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 "What is the average age of passengers?"

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-30 19:03:49 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 19:03:49 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# Execute SQL query to calculate the average age of passengers
sql_query = "SELECT AVG(Age) AS average_age FROM table_aec7a6bd6f78cb97d53618ce510b61d8"
average_age_df = execute_sql_query(sql_query)

# Extract the average age from the resulting dataframe
average_age = average_age_df['average_age'].iloc[0]

# Declare result var: 
result = { "type": "number", "value": average_age }
2025-03-30 19:03:49 [INFO] Validating code requirements...
2025-03-30 19:03:49 [INFO] Code validation successful.
2025-03-30 19:03:49 [INFO] Cleaning the generated code...
2025-03-30 19:03:49 [INFO] Executing code: import pandas as pd
sql_query = 'SELECT AVG(Age) AS average_age FROM table_aec7a6bd6f78cb97d53618ce510b61d8'
average_age_df = execute_sql_query(sql_query)
average_age = average_age_df['average_age'].iloc[0]
result = {'type': 'number', 'value': average_age}
2025-03-30 19:03:50 [INFO] Response generated successfully.
2025-03-30 19:07:58 [INFO] Question: What is the average age of the passengers
2025-03-30 19:07:58 [INFO] Running PandaAI with openai LLM...
2025-03-30 19:07:58 [INFO] Prompt ID: 25209fd6-fb32-4455-b5d2-99ae46837ef5
2025-03-30 19:07:58 [INFO] Generating new code...
2025-03-30 19:07:58 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_2db748e18326a83bc3654aebc5f76f33" dimensions="418x11">
PassengerId,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
892,3,"Kelly, Mr. James",male,34.5,0,0,330911,7.8292,,Q
893,3,"Wilkes, Mrs. James (Ellen Needs)",female,47.0,1,0,363272,7.0,,S
894,2,"Myles, Mr. Thomas Francis",male,62.0,0,0,240276,9.6875,,Q
895,3,"Wirz, Mr. Albert",male,27.0,0,0,315154,8.6625,,S
896,3,"Hirvonen, Mrs. Alexander (Helga E Lindqvist)",female,22.0,1,1,3101298,12.2875,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What is the average age of the passengers

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-30 19:08:00 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 19:08:00 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# Execute SQL query to calculate the average age of the passengers
sql_query = "SELECT AVG(Age) AS average_age FROM table_2db748e18326a83bc3654aebc5f76f33"
average_age_df = execute_sql_query(sql_query)

# Extract the average age from the dataframe
average_age = average_age_df['average_age'].iloc[0]

# Declare result var: 
result = { "type": "number", "value": average_age }
2025-03-30 19:08:00 [INFO] Validating code requirements...
2025-03-30 19:08:00 [INFO] Code validation successful.
2025-03-30 19:08:00 [INFO] Cleaning the generated code...
2025-03-30 19:08:00 [INFO] Executing code: import pandas as pd
sql_query = 'SELECT AVG(Age) AS average_age FROM table_2db748e18326a83bc3654aebc5f76f33'
average_age_df = execute_sql_query(sql_query)
average_age = average_age_df['average_age'].iloc[0]
result = {'type': 'number', 'value': average_age}
2025-03-30 19:08:00 [INFO] Response generated successfully.
2025-03-30 19:10:46 [INFO] Question: "What is the average age of passengers?"
2025-03-30 19:10:47 [INFO] Running PandaAI with openai LLM...
2025-03-30 19:10:47 [INFO] Prompt ID: 5298a7ca-1727-470d-a761-b0e784193015
2025-03-30 19:10:47 [INFO] Generating new code...
2025-03-30 19:10:47 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_2db748e18326a83bc3654aebc5f76f33" dimensions="418x11">
PassengerId,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
892,3,"Kelly, Mr. James",male,34.5,0,0,330911,7.8292,,Q
893,3,"Wilkes, Mrs. James (Ellen Needs)",female,47.0,1,0,363272,7.0,,S
894,2,"Myles, Mr. Thomas Francis",male,62.0,0,0,240276,9.6875,,Q
895,3,"Wirz, Mr. Albert",male,27.0,0,0,315154,8.6625,,S
896,3,"Hirvonen, Mrs. Alexander (Helga E Lindqvist)",female,22.0,1,1,3101298,12.2875,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 "What is the average age of passengers?"

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-30 19:10:48 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-30 19:10:48 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# Execute SQL query to calculate the average age of passengers
sql_query = "SELECT AVG(Age) AS average_age FROM table_2db748e18326a83bc3654aebc5f76f33"
average_age_df = execute_sql_query(sql_query)

# Extract the average age from the dataframe
average_age = average_age_df['average_age'].iloc[0]

# Declare result var: 
result = { "type": "number", "value": average_age }
2025-03-30 19:10:48 [INFO] Validating code requirements...
2025-03-30 19:10:48 [INFO] Code validation successful.
2025-03-30 19:10:48 [INFO] Cleaning the generated code...
2025-03-30 19:10:48 [INFO] Executing code: import pandas as pd
sql_query = 'SELECT AVG(Age) AS average_age FROM table_2db748e18326a83bc3654aebc5f76f33'
average_age_df = execute_sql_query(sql_query)
average_age = average_age_df['average_age'].iloc[0]
result = {'type': 'number', 'value': average_age}
2025-03-30 19:10:49 [INFO] Response generated successfully.
2025-03-31 13:25:22 [INFO] Question: What%20is%20the%20average%20age%20of%20passengers
2025-03-31 13:25:23 [INFO] Running PandaAI with openai LLM...
2025-03-31 13:25:23 [INFO] Prompt ID: 34eb4219-c5fe-4a1c-b425-24efa2d778fc
2025-03-31 13:25:23 [INFO] Generating new code...
2025-03-31 13:25:23 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_2db748e18326a83bc3654aebc5f76f33" dimensions="418x11">
PassengerId,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
892,3,"Kelly, Mr. James",male,34.5,0,0,330911,7.8292,,Q
893,3,"Wilkes, Mrs. James (Ellen Needs)",female,47.0,1,0,363272,7.0,,S
894,2,"Myles, Mr. Thomas Francis",male,62.0,0,0,240276,9.6875,,Q
895,3,"Wirz, Mr. Albert",male,27.0,0,0,315154,8.6625,,S
896,3,"Hirvonen, Mrs. Alexander (Helga E Lindqvist)",female,22.0,1,1,3101298,12.2875,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What%20is%20the%20average%20age%20of%20passengers

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-31 13:25:27 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-31 13:25:27 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# Execute SQL query to calculate the average age of passengers
sql_query = "SELECT AVG(Age) AS average_age FROM table_2db748e18326a83bc3654aebc5f76f33"
average_age_df = execute_sql_query(sql_query)

# Extract the average age from the dataframe
average_age = average_age_df['average_age'].iloc[0]

# Declare result var: 
result = {
    "type": "number",
    "value": average_age
}
2025-03-31 13:25:27 [INFO] Validating code requirements...
2025-03-31 13:25:27 [INFO] Code validation successful.
2025-03-31 13:25:27 [INFO] Cleaning the generated code...
2025-03-31 13:25:27 [INFO] Executing code: import pandas as pd
sql_query = 'SELECT AVG(Age) AS average_age FROM table_2db748e18326a83bc3654aebc5f76f33'
average_age_df = execute_sql_query(sql_query)
average_age = average_age_df['average_age'].iloc[0]
result = {'type': 'number', 'value': average_age}
2025-03-31 13:25:28 [INFO] Response generated successfully.
2025-03-31 13:25:44 [INFO] Question: How%20many%20female%20passengers%20are%20there
2025-03-31 13:25:44 [INFO] Running PandaAI with openai LLM...
2025-03-31 13:25:44 [INFO] Prompt ID: 91bc97ff-c511-46f3-8795-c5b809029194
2025-03-31 13:25:44 [INFO] Generating new code...
2025-03-31 13:25:44 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_2db748e18326a83bc3654aebc5f76f33" dimensions="418x11">
PassengerId,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
892,3,"Kelly, Mr. James",male,34.5,0,0,330911,7.8292,,Q
893,3,"Wilkes, Mrs. James (Ellen Needs)",female,47.0,1,0,363272,7.0,,S
894,2,"Myles, Mr. Thomas Francis",male,62.0,0,0,240276,9.6875,,Q
895,3,"Wirz, Mr. Albert",male,27.0,0,0,315154,8.6625,,S
896,3,"Hirvonen, Mrs. Alexander (Helga E Lindqvist)",female,22.0,1,1,3101298,12.2875,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 How%20many%20female%20passengers%20are%20there

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-31 13:25:48 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-31 13:25:48 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# Execute SQL query to count the number of female passengers
sql_query = """
SELECT COUNT(*) AS female_passenger_count
FROM table_2db748e18326a83bc3654aebc5f76f33
WHERE Sex = 'female'
"""

# Execute the query and store the result in a DataFrame
result_df = execute_sql_query(sql_query)

# Extract the count from the DataFrame
female_passenger_count = result_df['female_passenger_count'].iloc[0]

# Declare result var: 
result = {
    "type": "number",
    "value": female_passenger_count
}
2025-03-31 13:25:48 [INFO] Validating code requirements...
2025-03-31 13:25:48 [INFO] Code validation successful.
2025-03-31 13:25:48 [INFO] Cleaning the generated code...
2025-03-31 13:25:48 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT COUNT(*) AS female_passenger_count
FROM table_2db748e18326a83bc3654aebc5f76f33
WHERE Sex = 'female'
"""
result_df = execute_sql_query(sql_query)
female_passenger_count = result_df['female_passenger_count'].iloc[0]
result = {'type': 'number', 'value': female_passenger_count}
2025-03-31 13:25:48 [INFO] Response generated successfully.
2025-03-31 13:26:12 [INFO] Question: How%20many%20male%20passengers%20are%20there
2025-03-31 13:26:12 [INFO] Running PandaAI with openai LLM...
2025-03-31 13:26:12 [INFO] Prompt ID: 06062d3a-8f1e-45c7-9366-b33735816f39
2025-03-31 13:26:12 [INFO] Generating new code...
2025-03-31 13:26:12 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_2db748e18326a83bc3654aebc5f76f33" dimensions="418x11">
PassengerId,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
892,3,"Kelly, Mr. James",male,34.5,0,0,330911,7.8292,,Q
893,3,"Wilkes, Mrs. James (Ellen Needs)",female,47.0,1,0,363272,7.0,,S
894,2,"Myles, Mr. Thomas Francis",male,62.0,0,0,240276,9.6875,,Q
895,3,"Wirz, Mr. Albert",male,27.0,0,0,315154,8.6625,,S
896,3,"Hirvonen, Mrs. Alexander (Helga E Lindqvist)",female,22.0,1,1,3101298,12.2875,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 How%20many%20male%20passengers%20are%20there

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-31 13:26:15 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-31 13:26:15 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# Execute SQL query to count male passengers
sql_query = """
SELECT COUNT(*) AS male_passenger_count
FROM table_2db748e18326a83bc3654aebc5f76f33
WHERE Sex = 'male'
"""

# Get the result as a DataFrame
male_passenger_count_df = execute_sql_query(sql_query)

# Extract the count from the DataFrame
male_passenger_count = male_passenger_count_df['male_passenger_count'].iloc[0]

# Declare result var: 
result = {
    "type": "number",
    "value": male_passenger_count
}
2025-03-31 13:26:15 [INFO] Validating code requirements...
2025-03-31 13:26:15 [INFO] Code validation successful.
2025-03-31 13:26:15 [INFO] Cleaning the generated code...
2025-03-31 13:26:15 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT COUNT(*) AS male_passenger_count
FROM table_2db748e18326a83bc3654aebc5f76f33
WHERE Sex = 'male'
"""
male_passenger_count_df = execute_sql_query(sql_query)
male_passenger_count = male_passenger_count_df['male_passenger_count'].iloc[0]
result = {'type': 'number', 'value': male_passenger_count}
2025-03-31 13:26:15 [INFO] Response generated successfully.
2025-03-31 13:26:46 [INFO] Question: What%20is%20the%20total%20number%20of%20passengers
2025-03-31 13:26:46 [INFO] Running PandaAI with openai LLM...
2025-03-31 13:26:46 [INFO] Prompt ID: bc049e2e-ce28-4990-90cd-e630fa68029e
2025-03-31 13:26:46 [INFO] Generating new code...
2025-03-31 13:26:46 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_2db748e18326a83bc3654aebc5f76f33" dimensions="418x11">
PassengerId,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
892,3,"Kelly, Mr. James",male,34.5,0,0,330911,7.8292,,Q
893,3,"Wilkes, Mrs. James (Ellen Needs)",female,47.0,1,0,363272,7.0,,S
894,2,"Myles, Mr. Thomas Francis",male,62.0,0,0,240276,9.6875,,Q
895,3,"Wirz, Mr. Albert",male,27.0,0,0,315154,8.6625,,S
896,3,"Hirvonen, Mrs. Alexander (Helga E Lindqvist)",female,22.0,1,1,3101298,12.2875,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What%20is%20the%20total%20number%20of%20passengers

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-31 13:26:49 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-31 13:26:49 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# Execute SQL query to get the total number of passengers
sql_query = "SELECT COUNT(*) AS total_passengers FROM table_2db748e18326a83bc3654aebc5f76f33"
total_passengers_df = execute_sql_query(sql_query)

# Extract the total number of passengers from the dataframe
total_passengers = total_passengers_df['total_passengers'].iloc[0]

# Declare result var: 
result = {
    "type": "number",
    "value": total_passengers
}
2025-03-31 13:26:49 [INFO] Validating code requirements...
2025-03-31 13:26:49 [INFO] Code validation successful.
2025-03-31 13:26:49 [INFO] Cleaning the generated code...
2025-03-31 13:26:49 [INFO] Executing code: import pandas as pd
sql_query = 'SELECT COUNT(*) AS total_passengers FROM table_2db748e18326a83bc3654aebc5f76f33'
total_passengers_df = execute_sql_query(sql_query)
total_passengers = total_passengers_df['total_passengers'].iloc[0]
result = {'type': 'number', 'value': total_passengers}
2025-03-31 13:26:49 [INFO] Response generated successfully.
2025-03-31 13:27:07 [INFO] Question: What%20is%20the%20average%20age%20passengers%20in%20Pclass%203
2025-03-31 13:27:07 [INFO] Running PandaAI with openai LLM...
2025-03-31 13:27:07 [INFO] Prompt ID: 07c3398f-cfd3-4a1f-aa83-05106e14f892
2025-03-31 13:27:07 [INFO] Generating new code...
2025-03-31 13:27:07 [INFO] Using Prompt: <tables>

<table dialect="duckdb" table_name="table_2db748e18326a83bc3654aebc5f76f33" dimensions="418x11">
PassengerId,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
892,3,"Kelly, Mr. James",male,34.5,0,0,330911,7.8292,,Q
893,3,"Wilkes, Mrs. James (Ellen Needs)",female,47.0,1,0,363272,7.0,,S
894,2,"Myles, Mr. Thomas Francis",male,62.0,0,0,240276,9.6875,,Q
895,3,"Wirz, Mr. Albert",male,27.0,0,0,315154,8.6625,,S
896,3,"Hirvonen, Mrs. Alexander (Helga E Lindqvist)",female,22.0,1,1,3101298,12.2875,,S
</table>


</tables>

You are already provided with the following functions that you can call:
<function>
def execute_sql_query(sql_query: str) -> pd.Dataframe
    """This method connects to the database, executes the sql query and returns the dataframe"""
</function>


Update this initial code:
```python
# TODO: import the required dependencies
import pandas as pd

# Write code here

# Declare result var: 
type (possible values "string", "number", "dataframe", "plot"). Examples: { "type": "string", "value": f"The highest salary is {highest_salary}." } or { "type": "number", "value": 125 } or { "type": "dataframe", "value": pd.DataFrame({...}) } or { "type": "plot", "value": "temp_chart.png" }

```



### QUERY
 What%20is%20the%20average%20age%20passengers%20in%20Pclass%203

At the end, declare "result" variable as a dictionary of type and value.


Generate python code and return full updated code:

### Note: Use only relevant table for query and do aggregation, sorting, joins and grouby through sql query
2025-03-31 13:27:10 [INFO] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-03-31 13:27:10 [INFO] Code Generated:
# TODO: import the required dependencies
import pandas as pd

# Define the SQL query to calculate the average age of passengers in Pclass 3
sql_query = """
SELECT AVG(Age) AS average_age
FROM table_2db748e18326a83bc3654aebc5f76f33
WHERE Pclass = 3
"""

# Execute the SQL query and store the result in a DataFrame
average_age_df = execute_sql_query(sql_query)

# Extract the average age from the DataFrame
average_age = average_age_df['average_age'].iloc[0]

# Declare result var: 
result = {
    "type": "number",
    "value": average_age
}
2025-03-31 13:27:10 [INFO] Validating code requirements...
2025-03-31 13:27:10 [INFO] Code validation successful.
2025-03-31 13:27:10 [INFO] Cleaning the generated code...
2025-03-31 13:27:10 [INFO] Executing code: import pandas as pd
sql_query = """
SELECT AVG(Age) AS average_age
FROM table_2db748e18326a83bc3654aebc5f76f33
WHERE Pclass = 3
"""
average_age_df = execute_sql_query(sql_query)
average_age = average_age_df['average_age'].iloc[0]
result = {'type': 'number', 'value': average_age}
2025-03-31 13:27:10 [INFO] Response generated successfully.
